(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5579:(e,t,s)=>{Promise.resolve().then(s.bind(s,8906))},5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}})},8054:(e,t,s)=>{"use strict";s.d(t,{AuthProvider:()=>u,A:()=>d});var a=s(5155),n=s(2115),l=s(6203);let i=(0,s(3915).Wp)({apiKey:"AIzaSyCuADpl1-PYC5h9RVpBZi-ksvIW80rhXoE",authDomain:"socialai-2ef6e.firebaseapp.com",projectId:"socialai-2ef6e",storageBucket:"socialai-2ef6e.firebasestorage.app",messagingSenderId:"1030121993524",appId:"1:1030121993524:web:88726b6d19892e9987e161"}),r=(0,l.xI)(i),o=(0,n.createContext)({}),d=()=>(0,n.useContext)(o),u=e=>{let{children:t}=e,[s,i]=(0,n.useState)(null),[d,u]=(0,n.useState)(!0);(0,n.useEffect)(()=>{let e=(0,l.hg)(r,e=>{e?i({uid:e.uid,email:e.email,displayName:e.displayName}):i(null),u(!1)});return()=>e()},[]);let c=async()=>{i(null),await (0,l.CI)(r)},h=async()=>{let e=new l.HF;return(0,l.df)(r,e)};return(0,a.jsx)(o.Provider,{value:{user:s,login:(e,t)=>(0,l.x9)(r,e,t),signup:(e,t)=>(0,l.eJ)(r,e,t),logout:c,signInWithGoogle:h},children:!d&&t})}},8906:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>u});var a=s(5155),n=s(2115),l=s(8054),i=s(5695);function r(e){let{children:t}=e,{user:s}=(0,l.A)(),a=(0,i.useRouter)();return(0,n.useEffect)(()=>{s||a.push("/login")},[s,a]),s?t:null}let o="https://social-ai-backend-f6dmr6763q-uc.a.run.app",d={CHAT:"".concat(o,"/api/chat"),END_CHAT:"".concat(o,"/api/end-chat")};function u(){let[e,t]=(0,n.useState)([]),[s,i]=(0,n.useState)(""),[o,u]=(0,n.useState)(!1),[c,h]=(0,n.useState)(null),m=(0,n.useRef)(null),{user:f,logout:b}=(0,l.A)(),g=()=>{var e;null==(e=m.current)||e.scrollIntoView({behavior:"smooth"})};(0,n.useEffect)(()=>{g()},[e]);let x=(0,n.useCallback)(async()=>{if(c&&(null==f?void 0:f.uid))try{if(!(await fetch(d.END_CHAT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:c,userId:f.uid}),credentials:"include"})).ok)throw Error("Failed to end chat session");h(null)}catch(e){console.error("Error ending chat session:",e)}},[c,f]);(0,n.useEffect)(()=>()=>{c&&(null==f?void 0:f.uid)&&x()},[c,f,x]),(0,n.useEffect)(()=>{let e=()=>{if(c&&(null==f?void 0:f.uid)){let e=JSON.stringify({sessionId:c,userId:f.uid});navigator.sendBeacon(d.END_CHAT,e)}};return window.addEventListener("beforeunload",e),()=>{window.removeEventListener("beforeunload",e)}},[c,f]);let p=async e=>{if(e.preventDefault(),s.trim()){t(e=>[...e,{role:"user",content:s}]),u(!0);try{let e=await fetch(d.CHAT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:s,sessionId:c,userId:null==f?void 0:f.uid,email:null==f?void 0:f.email}),credentials:"include"});if(!e.ok)throw Error("Failed to send message");let a=await e.json();a.sessionId&&!c&&h(a.sessionId),t(e=>[...e,{role:"assistant",content:a.response}])}catch(e){console.error("Error:",e),t(e=>[...e,{role:"assistant",content:"Meow~ I seem to be having trouble connecting. Try again later?"}])}finally{u(!1),i("")}}},v=async()=>{try{c&&(null==f?void 0:f.uid)&&await x(),await b(),h(null),t([])}catch(e){console.error("Failed to log out:",e)}};return(0,a.jsx)(r,{children:(0,a.jsx)("main",{className:"flex min-h-screen flex-col items-center justify-between p-4 md:p-24 bg-gradient-to-b from-gray-900 to-gray-800",children:(0,a.jsxs)("div",{className:"z-10 w-full max-w-3xl",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-center",children:"Chat with Puck"}),(0,a.jsx)("button",{onClick:v,className:"px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg text-white",children:"Sign Out"})]}),(0,a.jsxs)("div",{className:"bg-white/10 p-4 rounded-lg shadow-lg mb-4 h-[60vh] overflow-y-auto",children:[e.map((e,t)=>(0,a.jsxs)("div",{className:"mb-4 ".concat("user"===e.role?"text-right":"text-left"),children:[(0,a.jsx)("div",{className:"inline-block p-3 rounded-lg ".concat("user"===e.role?"bg-blue-500 text-white rounded-br-none":"bg-gray-300 text-black rounded-bl-none"),children:e.content}),(0,a.jsx)("div",{className:"text-xs mt-1 text-gray-400",children:"user"===e.role?(null==f?void 0:f.email)||"You":"Puck"})]},t)),o&&(0,a.jsxs)("div",{className:"text-left mb-4",children:[(0,a.jsx)("div",{className:"inline-block p-3 rounded-lg bg-gray-300 text-black rounded-bl-none",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("div",{className:"h-2 w-2 bg-gray-500 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"h-2 w-2 bg-gray-500 rounded-full animate-bounce delay-75"}),(0,a.jsx)("div",{className:"h-2 w-2 bg-gray-500 rounded-full animate-bounce delay-150"})]})}),(0,a.jsx)("div",{className:"text-xs mt-1 text-gray-400",children:"Puck"})]}),(0,a.jsx)("div",{ref:m})]}),(0,a.jsxs)("form",{onSubmit:p,className:"flex gap-2",children:[(0,a.jsx)("input",{type:"text",value:s,onChange:e=>i(e.target.value),placeholder:"Ask Puck something...",className:"flex-1 p-2 rounded-lg bg-white/10 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",disabled:o}),(0,a.jsx)("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded-lg disabled:opacity-50",disabled:o||!s.trim(),children:"Send"})]})]})})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[158,853,441,684,358],()=>t(5579)),_N_E=e.O()}]);